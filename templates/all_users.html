<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/stylesheets/main.css">
    <title>Discovery</title>
    <style>
        .wanted-poster {
            position: relative;
            display: inline-block;
            width: 150px;
            /* Adjust width as necessary */
            height: 200px;
            /* Adjust height as necessary */
            margin: 10px;
            /* Space between posters */
        }

        .avatar-preview {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 20px;
            overflow: hidden;
            /* Prevents overflow */
        }

        .avatar-face {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ensure the image covers the area */
            position: absolute;
            /* Position it absolutely */
            z-index: 1;
            /* Place face below other elements */
        }

        .avatar-hair {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ensure the hair image covers the area */
            z-index: 2;
            /* Place hair above face */
        }

        .accessory {
            position: absolute;
            width: 100%;
            height: auto;
            /* Adjust height based on width */
            left: 0;
            z-index: 3;
            /* Place accessories above other layers */
        }
    </style>
    <script>
        function updateAvatars(users, avatars) {
            Object.keys(users).forEach(function (username) {
                const avatarData = avatars[username];

                // Get the container elements by id
                const hairPreview = document.getElementById('hairPreview-' + username);
                const hatPreview = document.getElementById('hatPreview-' + username);
                const bandanaPreview = document.getElementById('bandanaPreview-' + username);
                const glassesPreview = document.getElementById('glassesPreview-' + username);
                const pipePreview = document.getElementById('pipePreview-' + username);

                // Check if the elements exist before applying any changes
                if (avatarData && avatarData.hairstyle && hairPreview) {
                    hairPreview.src = `/static/assets/images/hair/${avatarData.hairstyle}.png`;
                } else {
                    console.warn(`Hair preview not found for user: ${username}`);
                }

                // Display hat if applicable
                if (avatarData.hat && hatPreview) {
                    hatPreview.style.display = 'block';
                }

                // Display bandana if applicable
                if (avatarData.bandana && bandanaPreview) {
                    bandanaPreview.style.display = 'block';
                }

                // Display glasses if applicable
                if (avatarData.glasses && glassesPreview) {
                    glassesPreview.style.display = 'block';
                }

                // Display pipe if applicable
                if (avatarData.pipe && pipePreview) {
                    pipePreview.style.display = 'block';
                }
            });
        }



        window.onload = function () {
            const avatarsData = {{ avatars| tojson
        }};  // Pass the avatar data to JS
        const userData = {{ users| tojson }}

        console.log(avatarsData);
        console.log(userData);
        updateAvatars(userData, avatarsData);
        }

    </script>
</head>

<body>
    <div class="container">
        <h1>
            <img src="../static/assets/images/Star.png" alt="icon" class="header-icon">
            Discovery
            <img src="../static/assets/images/Star.png" alt="icon" class="header-icon-flipped">

        </h1>
        <ul>
            {% for user, info in users.items() %}

            <li style="position: relative; padding-bottom: 100px; padding-top: 100px">
                <a href="{{ url_for('view_profile', username=user) }}" class="wanted-poster"
                    style="position:absolute; top:0; left:0;">
                    <img src="{{ url_for('static', filename='assets/images/wanted_poster.png') }}" alt="Wanted Poster"
                        class="wanted-poster">

                    <div class="avatar-preview" id="avatar-{{ user }}" style="position:absolute; bottom:0; left:0;">
                        <img class="avatar-face" id="facePreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/face.png') }}" alt="Face" style="right: 0;">
                        <img class="avatar-hair" id="hairPreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/hair/' + (avatar_data.hairstyle if avatar_data else 'hair_one') + '.png') }}"
                            alt="Hair">
                        <img class="accessory" id="hatPreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/accessories/RideACowboy_Hat.webp') }}" alt="Hat"
                            style="display: none;">
                        <img class="accessory" id="bandanaPreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/accessories/RideACowboy_Bandana.webp') }}"
                            alt="Bandana" style="display: none;">
                        <img class="accessory" id="glassesPreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/accessories/RideACowboy_Glasses.webp') }}"
                            alt="Glasses" style="display: none;">
                        <img class="accessory" id="pipePreview-{{ user }}"
                            src="{{ url_for('static', filename='assets/images/accessories/RideACowboy_Pipe.webp') }}"
                            alt="Pipe" style="display: none;">
                    </div>

                </a>



                {% if user in likes %}
                <form method="POST" style="display:inline; padding-left: 300px;">
                    <input type="hidden" name="liked_user" value="{{ user }}">
                    <button type="submit">Unlike</button>
                </form>
                {% else %}
                <form method="POST" style="display:inline;padding-left: 300px;">
                    <input type="hidden" name="liked_user" value="{{ user }}">
                    <button type="submit">Like</button>
                </form>
                {% endif %}
            </li>
            {% endfor %}
        </ul>

        <a href="{{ url_for('my_profile') }}">My Profile</a>
        | <a href="{{ url_for('matches') }}">My Matches</a>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <ul>
            {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}
    </div>
</body>

</html>